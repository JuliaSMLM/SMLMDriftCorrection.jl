<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Configuration · SMLMDriftCorrection.jl</title><meta name="title" content="Configuration · SMLMDriftCorrection.jl"/><meta property="og:title" content="Configuration · SMLMDriftCorrection.jl"/><meta property="twitter:title" content="Configuration · SMLMDriftCorrection.jl"/><meta name="description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="og:description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="twitter:description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="og:url" content="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/configuration/"/><meta property="twitter:url" content="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/configuration/"/><link rel="canonical" href="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/configuration/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SMLMDriftCorrection.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Configuration</a><ul class="internal"><li><a class="tocitem" href="#Input:-DriftConfig"><span>Input: DriftConfig</span></a></li><li><a class="tocitem" href="#Output:-DriftInfo"><span>Output: DriftInfo</span></a></li><li><a class="tocitem" href="#SMLD-Alignment"><span>SMLD Alignment</span></a></li></ul></li><li><a class="tocitem" href="../theory_workflow/">Theory &amp; Workflow</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Configuration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Configuration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/main/docs/src/configuration.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h1><p>The primary interface follows the JuliaSMLM tuple pattern:</p><pre><code class="language-julia hljs">(smld_corrected, info) = driftcorrect(smld, config)</code></pre><p>where <code>config</code> is a <a href="#SMLMDriftCorrection.DriftConfig"><code>DriftConfig</code></a> and <code>info</code> is a <a href="#SMLMDriftCorrection.DriftInfo"><code>DriftInfo</code></a>.</p><h2 id="Input:-DriftConfig"><a class="docs-heading-anchor" href="#Input:-DriftConfig">Input: DriftConfig</a><a id="Input:-DriftConfig-1"></a><a class="docs-heading-anchor-permalink" href="#Input:-DriftConfig" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="SMLMDriftCorrection.DriftConfig"><a class="docstring-binding" href="#SMLMDriftCorrection.DriftConfig"><code>SMLMDriftCorrection.DriftConfig</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">DriftConfig &lt;: AbstractSMLMConfig</code></pre><p>Configuration for drift correction, holding all algorithm parameters. Constructed with keyword arguments; all fields have sensible defaults.</p><p><strong>Fields</strong></p><table><tr><th style="text-align: left">Field</th><th style="text-align: left">Default</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>quality</code></td><td style="text-align: left"><code>:singlepass</code></td><td style="text-align: left">Quality tier: <code>:fft</code>, <code>:singlepass</code>, or <code>:iterative</code></td></tr><tr><td style="text-align: left"><code>degree</code></td><td style="text-align: left"><code>2</code></td><td style="text-align: left">Legendre polynomial degree for intra-dataset drift</td></tr><tr><td style="text-align: left"><code>dataset_mode</code></td><td style="text-align: left"><code>:registered</code></td><td style="text-align: left">Multi-dataset handling: <code>:registered</code> or <code>:continuous</code></td></tr><tr><td style="text-align: left"><code>chunk_frames</code></td><td style="text-align: left"><code>0</code></td><td style="text-align: left">Split datasets into chunks of N frames (0 = no chunking)</td></tr><tr><td style="text-align: left"><code>n_chunks</code></td><td style="text-align: left"><code>0</code></td><td style="text-align: left">Alternative: number of chunks per dataset (0 = use chunk_frames)</td></tr><tr><td style="text-align: left"><code>maxn</code></td><td style="text-align: left"><code>100</code></td><td style="text-align: left">Maximum neighbors for entropy calculation</td></tr><tr><td style="text-align: left"><code>max_iterations</code></td><td style="text-align: left"><code>10</code></td><td style="text-align: left">Maximum iterations for <code>:iterative</code> mode</td></tr><tr><td style="text-align: left"><code>convergence_tol</code></td><td style="text-align: left"><code>0.001</code></td><td style="text-align: left">Convergence tolerance in μm for <code>:iterative</code> mode</td></tr><tr><td style="text-align: left"><code>warm_start</code></td><td style="text-align: left"><code>nothing</code></td><td style="text-align: left">Previous <code>info.model</code> for warm starting optimization</td></tr><tr><td style="text-align: left"><code>verbose</code></td><td style="text-align: left"><code>0</code></td><td style="text-align: left">Verbosity level: 0=quiet, 1=info, 2=debug</td></tr><tr><td style="text-align: left"><code>auto_roi</code></td><td style="text-align: left"><code>false</code></td><td style="text-align: left">Use dense ROI subset for faster estimation</td></tr><tr><td style="text-align: left"><code>σ_loc</code></td><td style="text-align: left"><code>0.010</code></td><td style="text-align: left">Typical localization precision (μm) for ROI sizing</td></tr><tr><td style="text-align: left"><code>σ_target</code></td><td style="text-align: left"><code>0.001</code></td><td style="text-align: left">Target drift precision (μm) for ROI sizing</td></tr><tr><td style="text-align: left"><code>roi_safety_factor</code></td><td style="text-align: left"><code>4.0</code></td><td style="text-align: left">Safety multiplier for required localizations</td></tr></table><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; config = DriftConfig(quality=:iterative, degree=3);

julia&gt; config.quality
:iterative

julia&gt; config.degree
3

julia&gt; config.convergence_tol
0.001</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/1bd29dfb5605ad3ec3ef3487fd416cdddb8a4934/src/typedefs.jl#L14-L52">source</a></section></details></article><h3 id="Quality-Tiers"><a class="docs-heading-anchor" href="#Quality-Tiers">Quality Tiers</a><a id="Quality-Tiers-1"></a><a class="docs-heading-anchor-permalink" href="#Quality-Tiers" title="Permalink"></a></h3><p>The <code>quality</code> parameter selects the algorithm complexity:</p><ul><li><strong><code>:fft</code></strong> – Fast cross-correlation of histogram images. No intra-dataset correction. Best for quick previews or very large datasets.</li><li><strong><code>:singlepass</code></strong> (default) – One pass of entropy-based intra-dataset correction followed by inter-dataset alignment. Good balance of speed and accuracy.</li><li><strong><code>:iterative</code></strong> – Iterates intra and inter correction until convergence. Most accurate; resolves the coupling between intra and inter drift estimates.</li></ul><h3 id="Dataset-Modes"><a class="docs-heading-anchor" href="#Dataset-Modes">Dataset Modes</a><a id="Dataset-Modes-1"></a><a class="docs-heading-anchor-permalink" href="#Dataset-Modes" title="Permalink"></a></h3><p>The <code>dataset_mode</code> parameter controls how multiple datasets are related:</p><ul><li><strong><code>:registered</code></strong> (default) – Datasets are independent acquisitions of the same field of view (e.g., SeqSRM). Inter-dataset alignment finds the best constant shift for each dataset against the others.</li><li><strong><code>:continuous</code></strong> – One long acquisition split into multiple files or chunks. Polynomials are warm-started from the previous chunk&#39;s endpoint, and inter-shifts are regularized to maintain continuity.</li></ul><h3 id="Chunking-(Continuous-Mode)"><a class="docs-heading-anchor" href="#Chunking-(Continuous-Mode)">Chunking (Continuous Mode)</a><a id="Chunking-(Continuous-Mode)-1"></a><a class="docs-heading-anchor-permalink" href="#Chunking-(Continuous-Mode)" title="Permalink"></a></h3><p>For long continuous acquisitions, a single polynomial may not capture complex drift. Use <code>chunk_frames</code> or <code>n_chunks</code> to split each dataset into temporal segments, each modeled independently:</p><pre><code class="language-julia hljs"># Split into ~4000-frame chunks
config = DriftConfig(dataset_mode=:continuous, chunk_frames=4000)

# Or specify number of chunks
config = DriftConfig(dataset_mode=:continuous, n_chunks=3)</code></pre><p>Each chunk gets its own polynomial. Warm-starting from the previous chunk&#39;s endpoint ensures smooth transitions.</p><h3 id="Auto-ROI"><a class="docs-heading-anchor" href="#Auto-ROI">Auto-ROI</a><a id="Auto-ROI-1"></a><a class="docs-heading-anchor-permalink" href="#Auto-ROI" title="Permalink"></a></h3><p>When <code>auto_roi=true</code>, the algorithm selects a dense rectangular subregion of the field of view for drift estimation, then applies the fitted model to all localizations. This can significantly speed up processing for large datasets while trading some accuracy (~1.4 nm vs ~0.5 nm RMSD in testing).</p><p>The ROI size is determined by <code>σ_loc</code>, <code>σ_target</code>, and <code>roi_safety_factor</code>:</p><pre><code class="language-julia hljs">config = DriftConfig(auto_roi=true, σ_loc=0.010, σ_target=0.001)</code></pre><p>The estimated ROI indices are stored in <code>info.roi_indices</code>.</p><h3 id="Warm-Starting"><a class="docs-heading-anchor" href="#Warm-Starting">Warm Starting</a><a id="Warm-Starting-1"></a><a class="docs-heading-anchor-permalink" href="#Warm-Starting" title="Permalink"></a></h3><p>Pass a previously fitted model to initialize optimization:</p><pre><code class="language-julia hljs"># From a previous correction
(smld1, info1) = driftcorrect(smld1, DriftConfig(degree=2))

# Use as starting point for new data
config2 = DriftConfig(warm_start=info1.model)
(smld2, info2) = driftcorrect(smld2, config2)</code></pre><h2 id="Output:-DriftInfo"><a class="docs-heading-anchor" href="#Output:-DriftInfo">Output: DriftInfo</a><a id="Output:-DriftInfo-1"></a><a class="docs-heading-anchor-permalink" href="#Output:-DriftInfo" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="SMLMDriftCorrection.DriftInfo"><a class="docstring-binding" href="#SMLMDriftCorrection.DriftInfo"><code>SMLMDriftCorrection.DriftInfo</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">DriftInfo &lt;: AbstractSMLMInfo</code></pre><p>Metadata from drift correction, returned as second element of tuple. Supports warm start via <code>info.model</code>.</p><p><strong>Fields</strong></p><ul><li><code>model::LegendrePolynomial</code>: Fitted drift model (intra + inter)</li><li><code>elapsed_s::Float64</code>: Wall time in seconds</li><li><code>backend::Symbol</code>: Computation backend (<code>:cpu</code>)</li><li><code>iterations::Int</code>: Number of iterations completed (0 for :fft, 1 for :singlepass, N for :iterative)</li><li><code>converged::Bool</code>: Whether convergence criterion was met (always true for :fft/:singlepass)</li><li><code>entropy::Float64</code>: Final entropy value after correction</li><li><code>history::Vector{Float64}</code>: Entropy per iteration (empty for :fft)</li><li><code>roi_indices::Union{Nothing, Vector{Int}}</code>: Indices used for ROI subsampling (nothing if not used)</li></ul><p><strong>Usage</strong></p><pre><code class="language-julia hljs">(smld_corrected, info) = driftcorrect(smld)
info.converged    # check convergence
info.entropy      # final value
info.elapsed_s    # timing
plot(info.history)  # diagnostics
info.roi_indices  # ROI used for estimation (nothing if auto_roi=false)

# Warm start from previous result
(smld2, info2) = driftcorrect(smld2; warm_start=info.model)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/1bd29dfb5605ad3ec3ef3487fd416cdddb8a4934/src/typedefs.jl#L70-L98">source</a></section></details></article><h3 id="Accessing-Results"><a class="docs-heading-anchor" href="#Accessing-Results">Accessing Results</a><a id="Accessing-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-Results" title="Permalink"></a></h3><pre><code class="language-julia hljs">(smld_corrected, info) = driftcorrect(smld, DriftConfig())

# Diagnostics
info.converged     # true if convergence criterion met
info.entropy       # final entropy value
info.elapsed_s     # wall time in seconds
info.iterations    # iterations completed (0 for :fft, 1 for :singlepass)
info.history       # entropy per iteration (for plotting convergence)
info.roi_indices   # indices used for ROI subset (nothing if auto_roi=false)</code></pre><h3 id="Drift-Trajectory"><a class="docs-heading-anchor" href="#Drift-Trajectory">Drift Trajectory</a><a id="Drift-Trajectory-1"></a><a class="docs-heading-anchor-permalink" href="#Drift-Trajectory" title="Permalink"></a></h3><p>Extract the fitted drift model for plotting:</p><pre><code class="language-julia hljs">traj = drift_trajectory(info.model)
# traj.frames, traj.x, traj.y (and traj.z for 3D)

# For continuous mode, chain datasets end-to-end
traj = drift_trajectory(info.model; cumulative=true)</code></pre><h3 id="Continuation"><a class="docs-heading-anchor" href="#Continuation">Continuation</a><a id="Continuation-1"></a><a class="docs-heading-anchor-permalink" href="#Continuation" title="Permalink"></a></h3><p>Pass <code>DriftInfo</code> directly to continue iterating from a previous result:</p><pre><code class="language-julia hljs">(smld1, info1) = driftcorrect(smld, DriftConfig(quality=:singlepass))

# Continue with more iterations
(smld2, info2) = driftcorrect(smld, info1; max_iterations=5)</code></pre><h2 id="SMLD-Alignment"><a class="docs-heading-anchor" href="#SMLD-Alignment">SMLD Alignment</a><a id="SMLD-Alignment-1"></a><a class="docs-heading-anchor-permalink" href="#SMLD-Alignment" title="Permalink"></a></h2><p>For aligning independent SMLD structures (e.g., multi-color channels or separate acquisitions of the same FOV), use <code>align_smld</code> with <code>AlignConfig</code>.</p><h3 id="Input:-AlignConfig"><a class="docs-heading-anchor" href="#Input:-AlignConfig">Input: AlignConfig</a><a id="Input:-AlignConfig-1"></a><a class="docs-heading-anchor-permalink" href="#Input:-AlignConfig" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="SMLMDriftCorrection.AlignConfig"><a class="docstring-binding" href="#SMLMDriftCorrection.AlignConfig"><code>SMLMDriftCorrection.AlignConfig</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AlignConfig &lt;: AbstractSMLMConfig</code></pre><p>Configuration for rigid-shift alignment of independent SMLDs.</p><p><strong>Fields</strong></p><table><tr><th style="text-align: left">Field</th><th style="text-align: left">Default</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>method</code></td><td style="text-align: left"><code>:entropy</code></td><td style="text-align: left">Alignment method: <code>:entropy</code> (CC + entropy refinement) or <code>:fft</code> (CC only)</td></tr><tr><td style="text-align: left"><code>maxn</code></td><td style="text-align: left"><code>100</code></td><td style="text-align: left">Maximum neighbors for entropy calculation</td></tr><tr><td style="text-align: left"><code>histbinsize</code></td><td style="text-align: left"><code>0.05</code></td><td style="text-align: left">Histogram bin size (μm) for cross-correlation</td></tr><tr><td style="text-align: left"><code>verbose</code></td><td style="text-align: left"><code>0</code></td><td style="text-align: left">Verbosity level: 0=quiet, 1=info</td></tr></table></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/1bd29dfb5605ad3ec3ef3487fd416cdddb8a4934/src/typedefs.jl#L110-L123">source</a></section></details></article><h3 id="Output:-AlignInfo"><a class="docs-heading-anchor" href="#Output:-AlignInfo">Output: AlignInfo</a><a id="Output:-AlignInfo-1"></a><a class="docs-heading-anchor-permalink" href="#Output:-AlignInfo" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="SMLMDriftCorrection.AlignInfo"><a class="docstring-binding" href="#SMLMDriftCorrection.AlignInfo"><code>SMLMDriftCorrection.AlignInfo</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AlignInfo &lt;: AbstractSMLMInfo</code></pre><p>Result metadata from <code>align_smld</code>.</p><p><strong>Fields</strong></p><ul><li><code>shifts::Vector{Vector{Float64}}</code>: Recovered shift for each SMLD (shifts[1] = zeros)</li><li><code>elapsed_s::Float64</code>: Wall time in seconds</li><li><code>method::Symbol</code>: Method used (<code>:entropy</code> or <code>:fft</code>)</li><li><code>backend::Symbol</code>: Computation backend (<code>:cpu</code>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/1bd29dfb5605ad3ec3ef3487fd416cdddb8a4934/src/typedefs.jl#L131-L141">source</a></section></details></article><h3 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Entropy method (default) -- CC initial guess + entropy refinement
(aligned, info) = align_smld([smld_ch1, smld_ch2])
info.shifts  # [zeros(2), [dx, dy]]

# FFT method -- cross-correlation only
(aligned, info) = align_smld(smlds; method=:fft)

# Config struct form
config = AlignConfig(method=:entropy, maxn=100)
(aligned, info) = align_smld(smlds, config)</code></pre><p>The entropy method regularizes toward the cross-correlation initial guess to prevent optimizer divergence. Works on both 2D and 3D data, threaded across datasets.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../theory_workflow/">Theory &amp; Workflow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 18 February 2026 04:54">Wednesday 18 February 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
