<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · SMLMDriftCorrection.jl</title><meta name="title" content="Home · SMLMDriftCorrection.jl"/><meta property="og:title" content="Home · SMLMDriftCorrection.jl"/><meta property="twitter:title" content="Home · SMLMDriftCorrection.jl"/><meta name="description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="og:description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="twitter:description" content="Documentation for SMLMDriftCorrection.jl."/><meta property="og:url" content="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/"/><meta property="twitter:url" content="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/"/><link rel="canonical" href="https://JuliaSMLM.github.io/SMLMDriftCorrection.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>SMLMDriftCorrection.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Quick-Start"><span>Quick Start</span></a></li><li><a class="tocitem" href="#Usage-Examples"><span>Usage Examples</span></a></li><li><a class="tocitem" href="#Dataset-Modes"><span>Dataset Modes</span></a></li><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li><li><a class="tocitem" href="#Documentation"><span>Documentation</span></a></li></ul></li><li><a class="tocitem" href="configuration/">Configuration</a></li><li><a class="tocitem" href="theory_workflow/">Theory &amp; Workflow</a></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSMLM/SMLMDriftCorrection.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="SMLMDriftCorrection.jl"><a class="docs-heading-anchor" href="#SMLMDriftCorrection.jl">SMLMDriftCorrection.jl</a><a id="SMLMDriftCorrection.jl-1"></a><a class="docs-heading-anchor-permalink" href="#SMLMDriftCorrection.jl" title="Permalink"></a></h1><p>Fiducial-free drift correction for Single Molecule Localization Microscopy (SMLM).</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>SMLMDriftCorrection.jl implements entropy-based drift correction using Legendre polynomial models. The algorithm corrects both:</p><ul><li><strong>Intra-dataset drift</strong>: Drift within each dataset (movie segment) modeled as a polynomial over time</li><li><strong>Inter-dataset drift</strong>: Constant shifts between datasets to align them</li></ul><p>All distance units are in <strong>micrometers (μm)</strong>.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Pkg
Pkg.add(&quot;SMLMDriftCorrection&quot;)</code></pre><h2 id="Quick-Start"><a class="docs-heading-anchor" href="#Quick-Start">Quick Start</a><a id="Quick-Start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start" title="Permalink"></a></h2><pre><code class="language-julia hljs">using SMLMSim
using SMLMDriftCorrection
using SMLMRender
DC = SMLMDriftCorrection

# Simulate blinking data (hexamers, 2 datasets)
params = StaticSMLMConfig(7.5, 0.13, 50, 2, 1000, 50.0, 2, [0.0, 1.0])
(smld_noisy, _) = simulate(params;
    pattern=Nmer2D(n=6, d=0.2),
    molecule=GenericFluor(; photons=35000.0, k_on=0.25, k_off=50.0),
    camera=IdealCamera(1:32, 1:32, 0.1)
)

# Create synthetic drift (~200nm diagonal) and apply it
drift_true = DC.LegendrePolynomial(smld_noisy; degree=2, initialize=&quot;zeros&quot;)
for ds in 1:smld_noisy.n_datasets
    drift_true.intra[ds].dm[1].coefficients .= [0.10, 0.03]   # x drift
    drift_true.intra[ds].dm[2].coefficients .= [0.08, -0.02]   # y drift
end
drift_true.inter[2].dm .= [0.05, -0.03]
smld_drifted = DC.applydrift(smld_noisy, drift_true)

# Correct drift
(smld_corrected, info) = driftcorrect(smld_drifted)

# Results
N = length(smld_noisy.emitters)
rmsd = sqrt(sum(
    ([e.x for e in smld_corrected.emitters] .- [e.x for e in smld_noisy.emitters]).^2 .+
    ([e.y for e in smld_corrected.emitters] .- [e.y for e in smld_noisy.emitters]).^2
) / N)
println(&quot;Localizations: &quot;, N)
println(&quot;RMSD: &quot;, round(rmsd * 1000, digits=1), &quot; nm&quot;)
println(&quot;Elapsed: &quot;, round(info.elapsed_s, digits=1), &quot; s&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Localizations: 8471
RMSD: 0.3 nm
Elapsed: 90.5 s</code></pre><h3 id="Before-and-After"><a class="docs-heading-anchor" href="#Before-and-After">Before and After</a><a id="Before-and-After-1"></a><a class="docs-heading-anchor-permalink" href="#Before-and-After" title="Permalink"></a></h3><p>Histogram renders colored by frame number show drift smearing (before) and recovery (after):</p><p><strong>Drifted</strong> — localizations smeared by ~200 nm of drift:</p><pre><code class="language-julia hljs">(img_drifted, _) = render(smld_drifted, strategy=HistogramRender(), color_by=:frame, colormap=:turbo, zoom=10)
save_image(&quot;drifted.png&quot;, img_drifted)</code></pre><p><img src="drifted.png" alt="Drifted"/></p><p><strong>Corrected</strong> — hexamer structure recovered (RMSD ~1 nm):</p><pre><code class="language-julia hljs">(img_corrected, _) = render(smld_corrected, strategy=HistogramRender(), color_by=:frame, colormap=:turbo, zoom=10)
save_image(&quot;corrected.png&quot;, img_corrected)</code></pre><p><img src="corrected.png" alt="Corrected"/></p><h2 id="Usage-Examples"><a class="docs-heading-anchor" href="#Usage-Examples">Usage Examples</a><a id="Usage-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Usage-Examples" title="Permalink"></a></h2><h3 id="With-Simulated-Data"><a class="docs-heading-anchor" href="#With-Simulated-Data">With Simulated Data</a><a id="With-Simulated-Data-1"></a><a class="docs-heading-anchor-permalink" href="#With-Simulated-Data" title="Permalink"></a></h3><pre><code class="language-julia hljs">using SMLMSim
using SMLMDriftCorrection
DC = SMLMDriftCorrection

# Simulate data
params = StaticSMLMConfig(10.0, 0.13, 30, 3, 1000, 50.0, 2, [0.0, 1.0])
(smld_noisy, _) = simulate(params;
    pattern=Nmer2D(n=6, d=0.2),
    molecule=GenericFluor(; photons=5000.0, k_on=0.02, k_off=50.0),
    camera=IdealCamera(1:64, 1:64, 0.1)
)

# Create and apply synthetic drift
drift_true = DC.LegendrePolynomial(smld_noisy; degree=2, initialize=&quot;random&quot;, rscale=0.1)
smld_drifted = DC.applydrift(smld_noisy, drift_true)

# Correct drift
config = DriftConfig(verbose=1)
(smld_corrected, info) = driftcorrect(smld_drifted, config)</code></pre><h3 id="With-SMITE-Data"><a class="docs-heading-anchor" href="#With-SMITE-Data">With SMITE Data</a><a id="With-SMITE-Data-1"></a><a class="docs-heading-anchor-permalink" href="#With-SMITE-Data" title="Permalink"></a></h3><pre><code class="language-julia hljs">using SMLMData
using SMLMDriftCorrection

smd = SmiteSMD(path, file)   # *_Results.mat file
smld = load_smite_2d(smd)
(smld_corrected, info) = driftcorrect(smld, DriftConfig(verbose=1))</code></pre><h3 id="Filtering-to-ROI"><a class="docs-heading-anchor" href="#Filtering-to-ROI">Filtering to ROI</a><a id="Filtering-to-ROI-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering-to-ROI" title="Permalink"></a></h3><pre><code class="language-julia hljs">x = [e.x for e in smld.emitters]
y = [e.y for e in smld.emitters]
mask = (x .&gt; 64.0) .&amp; (x .&lt; 128.0) .&amp; (y .&gt; 64.0) .&amp; (y .&lt; 128.0)
smld_roi = filter_emitters(smld, mask)

(smld_corrected, info) = driftcorrect(smld_roi, DriftConfig())</code></pre><h3 id="Continuous-Acquisition-Mode"><a class="docs-heading-anchor" href="#Continuous-Acquisition-Mode">Continuous Acquisition Mode</a><a id="Continuous-Acquisition-Mode-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-Acquisition-Mode" title="Permalink"></a></h3><p>For data where drift accumulates across files (one long acquisition split into multiple datasets):</p><pre><code class="language-julia hljs"># Continuous mode - drift chains across datasets
config = DriftConfig(dataset_mode=:continuous)
(smld_corrected, info) = driftcorrect(smld, config)

# With chunking for finer-grained correction
config = DriftConfig(dataset_mode=:continuous, chunk_frames=4000)
(smld_corrected, info) = driftcorrect(smld, config)</code></pre><h3 id="Warm-Start-/-Continuation"><a class="docs-heading-anchor" href="#Warm-Start-/-Continuation">Warm Start / Continuation</a><a id="Warm-Start-/-Continuation-1"></a><a class="docs-heading-anchor-permalink" href="#Warm-Start-/-Continuation" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Warm start from previous model
config1 = DriftConfig(degree=2)
(smld1, info1) = driftcorrect(smld1, config1)

config2 = DriftConfig(warm_start=info1.model)
(smld2, info2) = driftcorrect(smld2, config2)

# Continue iterating from previous result
(smld3, info3) = driftcorrect(smld1, info1; max_iterations=5)</code></pre><h2 id="Dataset-Modes"><a class="docs-heading-anchor" href="#Dataset-Modes">Dataset Modes</a><a id="Dataset-Modes-1"></a><a class="docs-heading-anchor-permalink" href="#Dataset-Modes" title="Permalink"></a></h2><p>Both modes use the same entropy-based alignment algorithm. The difference is semantic:</p><ul><li><p><strong><code>:registered</code></strong> (default): Datasets are independent acquisitions. Use default trajectory plotting.</p></li><li><p><strong><code>:continuous</code></strong>: One long acquisition split into multiple files. Use <code>drift_trajectory(info.model; cumulative=true)</code> for plotting accumulated drift.</p></li></ul><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>The algorithm uses <strong>entropy minimization</strong> (Cnossen et al., 2021) with <strong>Legendre polynomial</strong> basis functions:</p><ol><li><p><strong>Intra-dataset</strong>: For each dataset, fit a Legendre polynomial (degree 2 by default) to model drift over time. Uses KL divergence-based entropy as cost function with adaptive KDTree neighbor rebuilding. Threaded across datasets.</p></li><li><p><strong>Inter-dataset</strong>: Align datasets using constant shifts optimized via merged-cloud entropy minimization. First pass aligns all to dataset 1 (threaded), then sequential refinement against all earlier datasets.</p></li><li><p><strong>Iterative</strong> (<code>:iterative</code> quality only): Repeat intra↔inter until inter-shift changes converge below tolerance.</p></li></ol><p>The Legendre polynomial basis provides better optimization conditioning than standard polynomials because the basis functions are orthogonal over the normalized time domain [-1, 1].</p><div class="admonition is-success" id="Threading-af3d8e547e67a010"><header class="admonition-header">Threading<a class="admonition-anchor" href="#Threading-af3d8e547e67a010" title="Permalink"></a></header><div class="admonition-body"><p>Intra-dataset correction and the first inter-dataset pass are parallelized with <code>Threads.@threads</code>. Start Julia with multiple threads (e.g., <code>julia -t auto</code>) for best performance on multi-dataset data.</p></div></div><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li><p>Cnossen J, et al. &quot;Drift correction in localization microscopy using entropy minimization&quot;, <em>Optics Express</em> 29(18), 2021. <a href="https://doi.org/10.1364/OE.426620">DOI: 10.1364/OE.426620</a></p></li><li><p>Wester MJ, et al. &quot;Robust, fiducial-free drift correction for super-resolution imaging&quot;, <em>Scientific Reports</em> 11, 2021. <a href="https://doi.org/10.1038/s41598-021-02850-7">DOI: 10.1038/s41598-021-02850-7</a></p></li></ul><h2 id="Documentation"><a class="docs-heading-anchor" href="#Documentation">Documentation</a><a id="Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation" title="Permalink"></a></h2><ul><li><a href="configuration/#Configuration">Configuration</a> - Full description of <code>DriftConfig</code> input and <code>DriftInfo</code> output</li><li><a href="theory_workflow/#Theory-and-Workflow">Theory &amp; Workflow</a> - Algorithm background, dataset modes, and quality tiers</li><li><a href="api/#API-Reference">API Reference</a> - Complete API documentation</li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="configuration/">Configuration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 9 February 2026 23:24">Monday 9 February 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
